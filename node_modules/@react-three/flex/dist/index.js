import e from"@babel/runtime/helpers/esm/extends";import t,{createContext as r,useContext as n,useMemo as i,useCallback as a,useRef as o,useLayoutEffect as s,useState as c}from"react";import l from"@react-pdf/yoga";import{useFrame as d,useThree as g}from"@react-three/fiber";import m from"react-merge-refs";import*as u from"three";import{Vector3 as p,Matrix4 as f}from"three";const h=e=>e[0].toUpperCase()+e.slice(1),x=e=>e.toUpperCase().replace("-","_"),w=(e,t,r)=>Object.keys(t).forEach((n=>{const i=t[n];if("string"==typeof i)switch(n){case"flexDir":case"dir":case"flexDirection":return e.setFlexDirection(l[`FLEX_DIRECTION_${x(i)}`]);case"align":return e.setAlignItems(l[`ALIGN_${x(i)}`]),e.setAlignContent(l[`ALIGN_${x(i)}`]);case"alignContent":return e.setAlignContent(l[`ALIGN_${x(i)}`]);case"alignItems":return e.setAlignItems(l[`ALIGN_${x(i)}`]);case"alignSelf":return e.setAlignSelf(l[`ALIGN_${x(i)}`]);case"justify":case"justifyContent":return e.setJustifyContent(l[`JUSTIFY_${x(i)}`]);case"wrap":case"flexWrap":return e.setFlexWrap(l[`WRAP_${x(i)}`]);case"basis":case"flexBasis":return e.setFlexBasis(i);default:return e[`set${h(n)}`](i)}else if("number"==typeof i){const t=i*r;switch(n){case"basis":case"flexBasis":return e.setFlexBasis(t);case"grow":case"flexGrow":return e.setFlexGrow(t);case"shrink":case"flexShrink":return e.setFlexShrink(t);case"align":return e.setAlignItems(i);case"justify":return e.setJustifyContent(i);case"flexDir":case"dir":return e.setFlexDirection(i);case"wrap":return e.setFlexWrap(i);case"padding":case"p":return e.setPadding(l.EDGE_ALL,t);case"paddingLeft":case"pl":return e.setPadding(l.EDGE_LEFT,t);case"paddingRight":case"pr":return e.setPadding(l.EDGE_RIGHT,t);case"paddingTop":case"pt":return e.setPadding(l.EDGE_TOP,t);case"paddingBottom":case"pb":return e.setPadding(l.EDGE_BOTTOM,t);case"margin":case"m":return e.setMargin(l.EDGE_ALL,t);case"marginLeft":case"ml":return e.setMargin(l.EDGE_LEFT,t);case"marginRight":case"mr":return e.setMargin(l.EDGE_RIGHT,t);case"marginTop":case"mt":return e.setMargin(l.EDGE_TOP,t);case"marginBottom":case"mb":return e.setMargin(l.EDGE_BOTTOM,t);default:return e[`set${h(n)}`](t)}}}));const y=e=>Object.keys(e).forEach((t=>void 0===e[t]?delete e[t]:{})),E=r({scaleFactor:100,requestReflow(){console.warn("Flex not initialized! Please report")},registerBox(){console.warn("Flex not initialized! Please report")},unregisterBox(){console.warn("Flex not initialized! Please report")},notInitialized:!0}),b=r({node:null,size:[0,0],notInitialized:!0});function B(e){let t=n(e);return t.notInitialized&&console.warn("You must place this hook/component under a <Flex/> component!"),t}function C(){const{requestReflow:e}=B(E);return e}function D(){const{size:[e,t],centerAnchor:r}=B(b);return i((()=>[e,t,r]),[e,t,r])}function I(){const{node:e}=B(b);return e}function W(){const{requestReflow:e,scaleFactor:t}=B(E),r=I();return a(((n,i)=>{if(null==r)throw new Error("yoga node is null. sync size is impossible");r.setWidth(n*t),r.setHeight(i*t),e()}),[r,e])}const L=new p;function R(){const e=W();return a((t=>{if(t.updateMatrixWorld(),L.setFromMatrixScale(t.matrixWorld),Math.abs(L.x-L.y)>.001||Math.abs(L.y-L.z)>.001)throw new Error("object was not scaled uniformly");const r=L.x;t.geometry.computeBoundingBox();const n=t.geometry.boundingBox;e((n.max.x-n.min.x)*r,(n.max.y-n.min.y)*r)}),[e])}function T(r,n){let{children:a,centerAnchor:g,flexDirection:u,flexDir:p,dir:f,alignContent:h,alignItems:x,alignSelf:D,align:I,justifyContent:W,justify:L,flexBasis:R,basis:T,flexGrow:F,grow:A,flexShrink:G,shrink:z,flexWrap:_,wrap:M,margin:P,m:S,marginBottom:j,marginLeft:v,marginRight:H,marginTop:O,mb:k,ml:N,mr:$,mt:U,padding:q,p:J,paddingBottom:Y,paddingLeft:V,paddingRight:X,paddingTop:K,pb:Q,pl:Z,pr:ee,pt:te,height:re,width:ne,maxHeight:ie,maxWidth:ae,minHeight:oe,minWidth:se,...ce}=r;const le=i((()=>{const e={flexDirection:u,flexDir:p,dir:f,alignContent:h,alignItems:x,alignSelf:D,align:I,justifyContent:W,justify:L,flexBasis:R,basis:T,flexGrow:F,grow:A,flexShrink:G,shrink:z,flexWrap:_,wrap:M,margin:P,m:S,marginBottom:j,marginLeft:v,marginRight:H,marginTop:O,mb:k,ml:N,mr:$,mt:U,padding:q,p:J,paddingBottom:Y,paddingLeft:V,paddingRight:X,paddingTop:K,pb:Q,pl:Z,pr:ee,pt:te,height:re,width:ne,maxHeight:ie,maxWidth:ae,minHeight:oe,minWidth:se};return y(e),e}),[I,h,x,D,f,R,T,p,u,F,A,G,z,_,re,L,W,S,P,j,v,H,O,ie,ae,k,oe,se,N,$,U,J,q,Y,V,X,K,Q,Z,ee,te,ne,M]),{registerBox:de,unregisterBox:ge,scaleFactor:me}=B(E),{node:ue}=B(b),pe=o(),fe=i((()=>l.Node.create()),[]),he=C();s((()=>{w(fe,le,me)}),[le,fe,me]),s((()=>{if(pe.current&&ue)return ue.insertChild(fe,ue.getChildCount()),de(fe,pe.current,le,g),()=>{ue.removeChild(fe),ge(fe)}}),[fe,ue,le,g,de,ge]),s((()=>{he()}),[a,le,he]);const[xe,we]=c([0,0]),ye=1/me;d((()=>{const e=("number"==typeof le.width?le.width:null)||fe.getComputedWidth().valueOf()/me,t=("number"==typeof le.height?le.height:null)||fe.getComputedHeight().valueOf()/me;(Math.abs(e-xe[0])>ye||Math.abs(t-xe[1])>ye)&&we([e,t])}));const Ee=i((()=>({node:fe,size:xe,centerAnchor:g})),[fe,xe,g]);return t.createElement("group",e({ref:m([pe,n])},ce),t.createElement(b.Provider,{value:Ee},"function"==typeof a?a(xe[0],xe[1],g):a))}const F=t.forwardRef(T);function A(r,n){let{size:c=[1,1,1],yogaDirection:h="ltr",plane:x="xy",children:B,scaleFactor:C=100,onReflow:D,disableSizeRecalc:I,centerAnchor:W,flexDirection:L,flexDir:R,dir:T,alignContent:F,alignItems:A,alignSelf:G,align:z,justifyContent:_,justify:M,flexBasis:P,basis:S,flexGrow:j,grow:v,flexShrink:H,shrink:O,flexWrap:k,wrap:N,margin:$,m:U,marginBottom:q,marginLeft:J,marginRight:Y,marginTop:V,mb:X,ml:K,mr:Q,mt:Z,padding:ee,p:te,paddingBottom:re,paddingLeft:ne,paddingRight:ie,paddingTop:ae,pb:oe,pl:se,pr:ce,pt:le,height:de,width:ge,maxHeight:me,maxWidth:ue,minHeight:pe,minWidth:fe,...he}=r;const xe=i((()=>{const e={flexDirection:L,flexDir:R,dir:T,alignContent:F,alignItems:A,alignSelf:G,align:z,justifyContent:_,justify:M,flexBasis:P,basis:S,flexGrow:j,grow:v,flexShrink:H,shrink:O,flexWrap:k,wrap:N,margin:$,m:U,marginBottom:q,marginLeft:J,marginRight:Y,marginTop:V,mb:X,ml:K,mr:Q,mt:Z,padding:ee,p:te,paddingBottom:re,paddingLeft:ne,paddingRight:ie,paddingTop:ae,pb:oe,pl:se,pr:ce,pt:le,height:de,width:ge,maxHeight:me,maxWidth:ue,minHeight:pe,minWidth:fe};return y(e),e}),[z,F,A,G,T,P,S,R,L,j,v,H,O,k,de,M,_,U,$,q,J,Y,V,me,ue,X,pe,fe,K,Q,Z,te,ee,re,ne,ie,ae,oe,se,ce,le,ge,N]),we=o(),ye=o([]),Ee=a((function(e,t,r,n){void 0===n&&(n=!1);const i=ye.current.findIndex((t=>t.node===e));-1!==i&&ye.current.splice(i,1),ye.current.push({group:t,node:e,flexProps:r,centerAnchor:n})}),[]),be=a((e=>{const t=ye.current.findIndex((t=>t.node===e));-1!==t&&ye.current.splice(t,1)}),[]),Be=i((()=>l.Node.create()),[]);s((()=>{w(Be,xe,C)}),[Be,xe,C]);const{invalidate:Ce}=g(),De=o(!0),Ie=a((()=>{De.current=!0,Ce()}),[Ce]);s((()=>{Ie()}),[B,xe,Ie]);const We=i((()=>new u.Box3),[]),Le=i((()=>new u.Vector3),[]),Re=x[0],Te=x[1],Fe=function(e){switch(e){case"xy":return"z";case"yz":return"x";case"xz":return"y"}}(x),[Ae,Ge]=function(e,t){switch(t){case"xy":return[e[0],e[1]];case"yz":return[e[1],e[2]];case"xz":return[e[0],e[2]]}}(c,x),ze="ltr"===h?l.DIRECTION_LTR:"rtl"===h?l.DIRECTION_RTL:h,_e=i((()=>({requestReflow:Ie,registerBox:Ee,unregisterBox:be,scaleFactor:C})),[Ie,Ee,be,C]),Me=i((()=>({node:Be,size:[Ae,Ge],centerAnchor:W})),[Be,Ae,Ge,W]);function Pe(){I||ye.current.forEach((e=>{let{group:t,node:r,flexProps:n}=e;const i="number"==typeof n.width?n.width*C:n.width,a="number"==typeof n.height?n.height*C:n.height;void 0!==i&&void 0!==a?(r.setWidth(i),r.setHeight(a)):0===r.getChildCount()&&(we.current?((e,t,r,n)=>{e.updateMatrix();const i=e.matrix,a=e.matrixAutoUpdate;t.updateMatrixWorld();const o=(new f).copy(t.matrixWorld).invert();e.matrix=o,e.matrixAutoUpdate=!1,t.updateMatrixWorld(),r.setFromObject(e).getSize(n),e.matrix=i,e.matrixAutoUpdate=a,t.updateMatrixWorld()})(t,we.current,We,Le):We.setFromObject(t).getSize(Le),r.setWidth(i||Le[Re]*C),r.setHeight(a||Le[Te]*C))})),Be.calculateLayout(Ae*C,Ge*C,ze);const e=Be.getComputedWidth(),t=Be.getComputedHeight();let r=0,n=0,i=0,a=0;ye.current.forEach((o=>{let{group:s,node:c,centerAnchor:l}=o;const{left:d,top:g,width:m,height:u}=c.getComputedLayout(),[f,h]=((e,t,r,n)=>e&&(e=>{var t;return!(null!=(t=e.getParent())&&t.getParent())})(n)?[-t/2,-r/2]:[0,0])(W,e,t,c),x=(e=>{let{x:t,y:r,z:n}=e;return new p(t,r,n)})({[Re]:(f+d+(l?m/2:0))/C,[Te]:-(h+g+(l?u/2:0))/C,[Fe]:0});r=Math.min(r,d),i=Math.min(i,g),n=Math.max(n,d+m),a=Math.max(a,g+u),s.position.copy(x)})),D&&D((n-r)/C,(a-i)/C),Ce()}return d((()=>{De.current&&(De.current=!1,Pe())})),t.createElement("group",e({ref:m([we,n])},he),t.createElement(E.Provider,{value:_e},t.createElement(b.Provider,{value:Me},B)))}F.displayName="Box";const G=t.forwardRef(A);G.displayName="Flex";export{F as Box,G as Flex,B as useContext,I as useFlexNode,D as useFlexSize,C as useReflow,W as useSetSize,R as useSyncGeometrySize};
